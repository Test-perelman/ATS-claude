QUICK START - APPLY PRODUCTION FIXES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â±ï¸  TIME REQUIRED: ~5 minutes
ğŸ¯ OBJECTIVE: Fix post-login data insertion errors


STEP 1: DEPLOY CODE (2 minutes)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

The code changes are already applied in:
  âœ… src/lib/auth-actions.ts
  âœ… src/app/api/candidates/route.ts

Just deploy normally:
  $ git add .
  $ git commit -m "Fix: production issues with signup and data insertion"
  $ git push
  $ npm run build && npm run start


STEP 2: APPLY DATABASE MIGRATION (3 minutes)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

This is the CRITICAL step that enables admin operations.

1. Open: https://supabase.com/dashboard/project

2. Click: "SQL Editor" (left sidebar)

3. Click: "New Query"

4. Copy and paste this SQL:

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- Grant service_role permissions to all tables
GRANT SELECT, INSERT, UPDATE, DELETE ON public.users TO service_role;
GRANT SELECT, INSERT, UPDATE, DELETE ON public.teams TO service_role;
GRANT SELECT, INSERT, UPDATE, DELETE ON public.roles TO service_role;
GRANT SELECT, INSERT, UPDATE, DELETE ON public.role_permissions TO service_role;
GRANT SELECT, INSERT, UPDATE, DELETE ON public.permissions TO service_role;
GRANT SELECT, INSERT, UPDATE, DELETE ON public.candidates TO service_role;
GRANT SELECT, INSERT, UPDATE, DELETE ON public.vendors TO service_role;
GRANT SELECT, INSERT, UPDATE, DELETE ON public.clients TO service_role;
GRANT SELECT, INSERT, UPDATE, DELETE ON public.job_requirements TO service_role;
GRANT SELECT, INSERT, UPDATE, DELETE ON public.submissions TO service_role;
GRANT SELECT, INSERT, UPDATE, DELETE ON public.interviews TO service_role;
GRANT SELECT, INSERT, UPDATE, DELETE ON public.projects TO service_role;
GRANT SELECT, INSERT, UPDATE, DELETE ON public.timesheets TO service_role;
GRANT SELECT, INSERT, UPDATE, DELETE ON public.invoices TO service_role;
GRANT SELECT, INSERT, UPDATE, DELETE ON public.immigration TO service_role;
GRANT SELECT, INSERT, UPDATE, DELETE ON public.notes TO service_role;

-- Grant function execution
GRANT EXECUTE ON FUNCTION public._rls_current_user_id() TO service_role;
GRANT EXECUTE ON FUNCTION public._rls_current_user_team_id() TO service_role;
GRANT EXECUTE ON FUNCTION public._rls_is_master_admin() TO service_role;

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

5. Click: "Run" button

6. Expected: "Success" message, all GRANT statements executed

âš ï¸  DO NOT CLOSE THIS PAGE - proceed to Step 3 to verify


STEP 3: VERIFY IT WORKS (2 minutes)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

In the same SQL Editor, run a test query:

  SELECT COUNT(*) FROM teams;

Expected: A number (not "permission denied error")

If you see "permission denied", the SQL migration didn't work. Go back to Step 2.


FINAL TEST
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. Sign up a new user
   - Go to login page
   - Click "Sign Up"
   - Email: test@example.com
   - Password: Password123!
   - Should succeed

2. Create a candidate
   - Navigate to Candidates
   - Click "New Candidate"
   - First Name: John
   - Last Name: Doe
   - Email: john@example.com
   - Click "Create Candidate"
   - Should succeed (no error)

3. Verify in database
   - Go back to Supabase SQL Editor
   - Run: SELECT * FROM users WHERE email = 'test@example.com';
   - Should show user with team_id (not NULL)

If all tests pass âœ…, you're done!


TROUBLESHOOTING
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Problem: "permission denied for table"
  â†’ Step 2 SQL migration failed
  â†’ Verify SQL ran with "Success" message

Problem: "Unknown column" error
  â†’ Code not deployed
  â†’ Redeploy latest code

Problem: Signup fails
  â†’ Check server logs for errors
  â†’ Verify env variables are set

Problem: Candidate creation fails
  â†’ Check user has team_id in database
  â†’ Verify RLS is enabled


WHAT CHANGED
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Code Changes:
  âœ… auth-actions.ts - signup/signin now create team + role + user
  âœ… candidates/route.ts - fixed column names and removed bad fields

Database Changes:
  âœ… SQL migration grants service_role permissions

Results:
  âœ… Admin operations work (no more permission errors)
  âœ… New users get team + role on signup
  âœ… Data insertion works (correct column names)
  âœ… Multi-tenant isolation enforced


DETAILED DOCUMENTATION
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

For more details, see:
  ğŸ“„ FIX_SUMMARY_FOR_USER.txt       - Complete summary
  ğŸ“„ PRODUCTION_FIX_REPORT.md        - Technical details
  ğŸ“„ MANUAL_FIX_GUIDE.md             - Step-by-step guide


NEED HELP?
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Check:
  1. SQL migration runs without errors
  2. Code is deployed
  3. User has team_id after signup
  4. No "permission denied" errors in logs
  5. No "unknown column" errors in logs


âœ… YOU'RE DONE!

Production fixes applied and verified.
